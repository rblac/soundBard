<!doctype html>
<html lang="en">
	<head>
		<title>SoundBard console</title>
		<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
		<!--<script src="/web/index.js">-->
		<style>
button {
	padding: 1em;
}
		</style>
	</head>
	<body>
		<p>hola mundo</p>

		<button onclick="test()">test</button>
		<hr>

		<!--<form id="fUpload" action="/upload" method="post" enctype="multipart/form-data">-->
		<input type=file accept=audio/* name="sound" id="ifUpload" />
		<button onclick="upload()">upload</button>

		<div id="dSoundList">
		</div>

		<script>
			const socket = io();

			const createRow = (s) => {
				return `<tr id="tr-${s.path}"><th scope="row">${s.path}</td><td>${s.author}</td><td><button onclick="playSound('${s.path}')">PLAY</button><button onclick="deleteSound('${s.path}')">X</button></td></tr>`
			};
			function htmlToDOM(html) {
				var temp = document.createElement('template');
				temp.innerHTML = html.trim();
				return temp.content.firstChild;
			}

			socket.on('list-data', (data) => {
				const dl = document.getElementById("dSoundList");

				var b = '<table id="tSounds"><tbody>';
				data.forEach((s) => b += createRow(s));
				b += "</tbody></table>";

				dl.innerHTML = b;
			})
			socket.on('new-sound', (s) => {
				const tb = document.getElementById("tSounds").getElementsByTagName('tbody')[0];
				const newRow = htmlToDOM(createRow(s), 'text/html');
				tb.appendChild(newRow);
			})
			socket.on('del-sound', (name) => {
				const tb = document.getElementById("tSounds").getElementsByTagName('tbody')[0];
				tb.removeChild(document.getElementById(`tr-${name}`));
			});

			function playSound(filename) {
				socket.emit('play', filename);
			}
			function deleteSound(filename) {
				socket.emit('delete', filename);
			}
			function setupList() {
				socket.emit('list', 'placeholder')
			}
			setupList();

			function upload() {
				const files = document.getElementById("ifUpload").files;
				if(!files || files.length != 1) {
					alert("select exactly 1 file.");
					return;
				}
				socket.emit('upload', files[0].name, files[0]);
			}
			function test() {
				socket.emit('test');
			}
		</script>
	</body>
</html>
